import{a as te,r as d,F as B,j as e,M as se,g as ne,c as ae,h as ie,B as w,U as re,e as J,P as E,D as R,k as oe,I as V,L as le,E as M,b as O,S as Q,C as ce,T as de,d as ue,R as xe,n as b,o as me,l as pe,m as he}from"./index-90501976.js";const fe=async y=>{const i=(await te.get(`https://mempool.space/api/address/${y}`)).data;let j=i.chain_stats.funded_txo_sum+i.mempool_stats.funded_txo_sum,n=i.chain_stats.spent_txo_sum+i.mempool_stats.spent_txo_sum,u=i.chain_stats.spent_txo_count+i.mempool_stats.spent_txo_count,f=j-n;return f/=1e8,{balance:Number(f).toFixed(8),spent_txo:u}},A=async y=>{let x;try{const i=await fe(y),j=i.balance,n=i.spent_txo;return x={address:y,balance:j,spent_txo:n,result:"success"},x}catch(i){return x={result:"error",reason:i.message},x}};const{TextArea:ge}=V,{Content:ye}=le,_e=()=>{const[y,x]=d.useState(!1),[i,j]=d.useState(!1),[n,u]=d.useState([]),[f]=B.useForm(),[D,F]=d.useState(!1),[_,I]=d.useState([]),[H,z]=d.useState(!1);let N=n.length+1;const[L,U]=d.useState(!1),[T,q]=d.useState(!0),K=()=>{q(!T)},X=()=>T?e.jsx(pe,{}):e.jsx(he,{});d.useEffect(()=>{z(!0);const t=localStorage.getItem("bitcoin_addresses");setTimeout(()=>{z(!1)},500),t&&u(JSON.parse(t)),U(!0)},[]),d.useEffect(()=>{L&&localStorage.setItem("bitcoin_addresses",JSON.stringify(n))},[n,L]);const $=[{title:"#",key:"index",align:"center",render:(t,s,h)=>h+1},{title:"备注",dataIndex:"name",key:"name",align:"center",className:"name",render:(t,s)=>{const h=t||e.jsx(M,{});return e.jsx(E,{title:e.jsx("div",{children:e.jsx(V,{placeholder:"请输入备注",defaultValue:t,onChange:c=>{s.name=c.target.value},allowClear:!0,bordered:!0})}),icon:e.jsx(M,{}),onConfirm:()=>{u([...n]),localStorage.setItem("bitcoin_addresses",JSON.stringify(n))},onCancel:()=>{},okText:"确定",cancelText:"取消",children:e.jsx(O,{color:"blue",style:{cursor:"pointer"},children:h})})}},{title:e.jsxs("span",{children:["钱包地址",e.jsx("span",{onClick:K,style:{marginLeft:8,cursor:"pointer"},children:X()})]}),dataIndex:"address",key:"address",align:"center",className:"address",render:(t,s)=>T?t.slice(0,4)+"***"+t.slice(-4):t},{title:"Bitcoin",children:[{title:"BTC",dataIndex:"balance",key:"btc_balance",align:"center",render:(t,s)=>t},{title:"spent_txo",dataIndex:"spent_txo",key:"spent_txo",align:"center",render:(t,s)=>t},{title:"状态",key:"result",align:"center",render:(t,s)=>e.jsxs(Q,{children:[s.result==="success"?e.jsx(O,{icon:e.jsx(ce,{}),color:"success",children:"成功"}):null,s.result==="error"?e.jsx(de,{title:s.reason,children:e.jsx(O,{icon:e.jsx(ue,{}),color:"error",children:"失败 "})}):null,s.result==="pending"?e.jsx(O,{icon:e.jsx(J,{spin:!0}),color:"processing",children:"获取中 "}):null]})},{title:"操作",key:"action",align:"center",render:(t,s)=>e.jsxs(Q,{children:[e.jsx(E,{title:"确认删除？",onConfirm:async()=>{await G(s.address)},children:e.jsx(w,{icon:e.jsx(R,{})})}),e.jsx(w,{icon:e.jsx(xe,{}),onClick:()=>{P(s.key)}})]})}]}],G=async t=>{u(n.filter(s=>s.address!==t)),localStorage.setItem("bitcoin_addresses",JSON.stringify(n.filter(s=>s.address!==t)))},W=async()=>{try{j(!0),x(!1);const s=(await f.validateFields()).addresses.split(`
`),h=2;let c=0,m=[];const S=()=>{for(;m.length>0&&c<h;){const a=m.shift();c+=1,a().finally(()=>{c-=1,S()})}};for(let a of s){a=a.trim();const p=()=>new Promise(async(k,v)=>{try{u(g=>{const o=[...g];if(o.findIndex(l=>l.address===a)===-1){const l={key:N.toString(),address:a,result:"pending"};N++,o.push(l)}return o});const C=await A(a);u(g=>{const o=[...g],r=o.findIndex(l=>l.address===a);return r!==-1&&(o[r]={...o[r],...C}),o}),k()}catch(C){v(C)}});m.push(p)}for(S();c>0||m.length>0;)await new Promise(a=>setTimeout(a,100));b.success({message:"成功",description:"批量添加完成",duration:1})}catch(t){b.error({message:"错误",description:t.message,duration:1})}finally{f.resetFields(),I([]),j(!1)}},P=async t=>{const s=t?[t]:_;if(!s.length){b.error({message:"错误",description:"请先选择要刷新的地址",duration:1});return}F(!0);try{let c=0,m=[];const S=()=>{for(;m.length>0&&c<2;){const a=m.shift();c+=1,a().finally(()=>{c-=1,S()})}};for(let a of s){const p=n.findIndex(k=>k.key===a);if(p!==-1){const k=()=>new Promise(async(v,C)=>{try{u(o=>{const r=[...o];for(let l in r[p])l!=="address"&&l!=="name"&&l!=="key"&&(l==="result"?r[p][l]="pending":r[p][l]=null);return r});const g=await A(n[p].address);u(o=>{const r=[...o];return r[p]={...r[p],...g},localStorage.setItem("bitcoin_addresses",JSON.stringify(r)),r}),v()}catch(g){C(g)}});m.push(k)}}for(S();c>0||m.length>0;)await new Promise(a=>setTimeout(a,100));b.success({message:"完成",description:"刷新地址数据完成",duration:1})}catch(h){b.error({message:"错误",description:h.message,duration:1})}finally{F(!1),t||I([])}},Y=async()=>{if(!_.length){b.error({message:"错误",description:"请先选择要删除的地址",duration:1});return}u(n.filter(t=>!_.includes(t.key))),localStorage.setItem("bitcoin_addresses",JSON.stringify(n.filter(t=>!_.includes(t.key)))),I([])},Z=()=>{me(n,"bitcoinInfo")};d.useState(null);const ee={selectedRowKeys:_,onChange:t=>{I(t)}};return e.jsx("div",{children:e.jsxs(ye,{children:[e.jsx(se,{title:"批量添加地址",open:y,onOk:W,onCancel:()=>{x(!1),f.resetFields()},okText:"添加地址",cancelText:"取消",width:800,children:e.jsx(B,{form:f,layout:"vertical",children:e.jsx(B.Item,{label:"地址",name:"addresses",rules:[{required:!0,validator:(t,s)=>(s.split(`
`),Promise.resolve())}],children:e.jsx(ge,{placeholder:"请输入地址，每行一个",style:{width:"100%",height:"300px",resize:"none"}})})})}),e.jsx("div",{style:{marginBottom:"50px"},children:e.jsx(ne,{spinning:H,size:"small",children:e.jsx(ae,{rowSelection:ee,dataSource:n,pagination:!1,bordered:!0,style:{marginBottom:"20px"},size:"small",columns:$})})}),e.jsx("div",{className:"bitcoin_footer",children:e.jsx(ie,{size:"small",style:{width:"100%"},children:e.jsxs("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"},children:[e.jsx(w,{type:"primary",onClick:()=>{x(!0)},size:"large",style:{width:"25%"},icon:e.jsx(re,{}),loading:i,children:i?"添加中...":"添加地址"}),e.jsx(w,{type:"primary",onClick:()=>P(),loading:D,size:"large",style:{width:"25%"},icon:e.jsx(J,{}),children:"刷新选中地址"}),e.jsx(E,{title:"确认删除"+_.length+"个地址？",onConfirm:async()=>{await Y()},children:e.jsx(w,{type:"primary",danger:!0,size:"large",style:{width:"25%"},icon:e.jsx(R,{}),children:"删除选中地址"})}),e.jsx(w,{type:"primary",icon:e.jsx(oe,{}),size:"large",style:{width:"8%"},onClick:Z})]})})})]})})};export{_e as default};
